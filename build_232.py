import pandas as pd
import re

OUTPUT_CSV = 'section232_rates.csv'
print("Building Smart Database for Section 232...")

s232_data = []

def add_list(raw_text, rate, category):
    # Extracts any number sequence from the raw text blocks
    codes = re.findall(r'[0-9\.]+', raw_text)
    for c in codes:
        clean = c.replace('.', '').strip()
        if len(clean) >= 4:
            s232_data.append({'hts8': clean, 's232_rate': rate, 'category': category})

# --- RAW TEXT DUMPS FROM CBP ANNEX PDFS ---
alum_derivatives = """
7610.10.00 7610.90.00 7612.90.10 7615.10.2015 7615.10.2025 7615.10.3015 7615.10.3025 7615.10.5020 7615.10.5040 7615.10.7125 7615.10.7130 7615.10.7155 7615.10.7180 7615.10.9100 7615.20.0000 7616.10.9090 7616.99.1000 7616.99.5130 7616.99.5140 7616.99.5190 7612.10.0000 7612.90.5000 7613.00.0000 7614.10.10
6603.90.8100 8302.10.3000 8302.10.6030 8302.10.6060 8302.10.6090 8302.20.0000 8302.30.3010 8302.30.3060 8302.41.3000 8302.41.6015 8302.41.6045 8302.41.6050 8302.41.6080 8302.42.3010 8302.42.3015 8302.42.3065 8302.49.6035 8302.49.6045 8302.49.6055 8302.49.6085 8302.50.0000 8302.60.3000 8302.60.9000 8305.10.0050 8306.30.0000 8414.59.6590 8415.90.8025 8415.90.8045 8415.90.8085 8418.99.8005 8418.99.8050 8418.99.8060 8419.50.5000 8419.90.1000 8422.90.0640 8424.90.9080 8473.30.2000 8473.30.5100 8479.89.9599 8479.90.8500 8479.90.9596 8481.90.9060 8481.90.9085 8486.90.0000 8487.90.0080 8503.00.9520 8508.70.0000 8513.90.2000 8515.90.2000 8516.90.5000 8516.90.8050 8517.71.0000 8517.79.0000 8529.90.7300 8529.90.9760 8536.90.8585 8538.10.0000 8541.90.0000 8543.90.8885 8547.90.0020 8547.90.0030 8547.90.0040 8708.10.3050 8708.10.60 8708.29.5160 8708.80.6590 8708.99.6890 8716.80.5010 8807.30.0060 9013.90.8000 9031.90.9195 9401.99.9081 9403.10.00 9403.20.00 9403.99.1040 9403.99.9010 9403.99.9015 9403.99.9020 9403.99.9040 9403.99.9045 9405.99.4020 9506.11.4080 9506.51.4000 9506.51.6000 9506.59.4040 9506.70.2090 9506.91.0010 9506.91.0020 9506.91.0030 9506.99.0510 9506.99.0520 9506.99.0530 9506.99.1500 9506.99.2000 9506.99.2580 9506.99.2800 9506.99.5500 9506.99.6080 9507.30.2000 9507.30.4000 9507.30.6000 9507.30.8000 9507.90.6000 9603.90.8050 2203.00.0060 2203.00.0090 0402.99.68 0402.99.70 0402.99.90 2106.90.9998 2710.19.3050 2903.43.10 2903.45.10 2903.49.00 2903.51.10 2903.59.90 3004.90.9244 3208.10.00 3208.20.00 3208.90.00 3209.10.00 3209.90.00 3213.90.00 3214.10.00 3303.00.10 3303.00.20 3303.00.30 3304.30.00 3304.99.50 3305.10.00 3305.30.00 3305.90.00 3306.90.00 3307.10.10 3307.10.20 3307.20.00 3307.49.00 3307.90.00 3401.30.10 3401.30.50 3402.31.90 3402.49.90 3402.50.11 3402.50.51 3402.90.10 3402.90.30 3402.90.50 3403.19.10 3403.19.50 3403.99.00 3405.10.00 3405.20.00 3405.40.00 3405.90.00 3506.10.50 3506.91.10 3506.91.50 3506.99.00 3701.30.0000 3808.59.10 3808.59.40 3808.61.10 3808.61.50 3808.62.10 3808.62.50 3808.69.10 3808.69.50 3808.91.15 3808.91.25 3808.91.30 3808.91.50 3808.94.10 3808.94.50 3809.91.00 3810.10.00 3811.19.00 3811.21.00 3814.00.10 3814.00.20 3814.00.50 3820.00.00 3824.99.9397 7308.20.0035 8307.90.6000 8309.90.0020 8309.90.0025 8412.90.9070 8412.90.9075 8414.80.16 8418.10.00 8419.50.1000 8424.89.90 8443.16.0000 8450.11.00 8451.21.00 8467.22.00 8467.29.00 8467.81.00 8467.89.50 8483.40.5020 8483.90.5020 8501.64.0110 8502.20.00 8502.31.0000 8503.00.9546 8503.00.9570 8504.31.20 8504.31.40 8504.31.60 8504.33.00 8504.34.00 8504.90.20 8504.90.41 8504.90.65 8504.90.75 8504.90.96 8544.19.00 8544.42.90 8544.49.2000 8544.49.9000 8544.60.2000 8544.60.6000 8716.39.0040 9401.79.00
"""
add_list(alum_derivatives, 50.0, 'Aluminum-Derivative')

steel_derivatives = """
7301.20.10 7301.20.50 7302.30.00 7307.21.10 7307.21.50 7307.22.10 7307.22.50 7307.23.00 7307.29.00 7307.91.10 7307.91.30 7307.91.50 7307.92.30 7307.92.90 7307.93.30 7307.93.60 7307.93.90 7307.99.10 7307.99.30 7307.99.50 7308.10.00 7308.20.00 7308.30.10 7308.30.50 7308.40.00 7308.90.30 7308.90.60 7308.90.70 7308.90.95 7309.00.00 7310.10.00 7310.21.00 7310.29.00 7311.00.00 7312.10.05 7312.10.10 7312.10.20 7312.10.30 7312.10.50 7312.10.60 7312.10.70 7312.10.80 7312.10.90 7312.90.00 7313.00.00 7314.12.10 7314.12.20 7314.12.30 7314.12.60 7314.12.90 7314.14.10 7314.14.20 7314.14.30 7314.14.60 7314.14.90 7314.19.01 7314.20.00 7314.31.10 7314.31.50 7314.39.00 7314.41.00 7314.42.00 7314.49.30 7314.49.60 7314.50.00 7315.11.00 7315.12.00 7315.19.00 7315.20.10 7315.20.50 7315.81.00 7315.82.10 7315.82.30 7315.82.50 7315.82.70 7315.89.10 7315.89.30 7315.89.50 7315.90.00 7316.00.00 7317.00.10 7317.00.20 7317.00.55 7317.00.65 7317.00.75 7318.11.00 7318.12.00 7318.13.00 7318.14.10 7318.14.50 7318.15.20 7318.15.40 7318.15.50 7318.15.60 7318.15.80 7318.16.00 7318.19.00 7318.21.00 7318.22.00 7318.23.00 7318.24.00 7318.29.00 7319.40.20 7319.40.30 7319.40.50 7319.90.10 7319.90.90 7320.10.30 7320.10.60 7320.10.90 7320.20.10 7320.20.50 7320.90.10 7320.90.50 7321.11.10 7321.11.30 7321.11.60 7321.12.00 7321.19.00 7321.81.10 7321.81.50 7321.82.10 7321.82.50 7321.89.00 7321.90.10 7321.90.20 7321.90.40 7321.90.50 7321.90.60 7322.19.00 7322.90.00 7323.10.00 7323.93.00 7323.94.00 7323.99.10 7323.99.30 7323.99.50 7323.99.70 7323.99.90 7324.10.00 7324.29.00 7324.90.00 7325.91.00 7325.99.10 7325.99.50 7326.11.00 7326.19.00 7326.20.00 7326.90.10 7326.90.25 7326.90.35 7326.90.45 7326.90.60 7326.90.86 7317.00.5501 7317.00.5502 7317.00.5508 7317.00.5511 7317.00.5518 7317.00.5519 7317.00.5520 7317.00.5530 7317.00.5540 7317.00.5550 7317.00.5570 7317.00.5590 7317.00.6530 7216.91.0010 7302.90.9000 7307.19.30 7307.19.90
8431.31.00 8431.42.00 8431.49.10 8431.49.90 8432.10.00 8432.90.00 8547.90.00 9403.20.00 9405.99.20 9405.99.40 9406.20.00 9406.90.01 8418.10.00 8418.30.00 8418.40.00 8422.11.00 8450.11.00 8450.20.00 8451.21.00 8451.29.00 8509.80.20 8516.60.40 9403.99.9020 0402.99.68 8211.91.20 8429.11.00 8504.23.00 0402.99.70 8211.91.25 8429.19.00 8504.33.00 0402.99.90 8211.91.30 8429.20.00 8504.90.9634 2106.90.9998 8211.91.40 8429.30.00 8504.90.9638 2710.19.3050 8211.91.50 8429.40.00 8504.90.9642 2711.12.0020 8211.91.80 8429.51.10 8514.20.40 2804.29.0010 8211.92.20 8429.51.50 8514.20.60 2804.40.0000 8211.92.40 8429.52.10 8516.29.00 2901.22.0000 8211.92.60 8429.52.50 8516.60.60 2903.42.1000 8211.92.90 8429.59.10 8601.10.00 2903.43.10 8211.93.00 8429.59.50 8601.20.00 2903.44.10 8211.94.10 8431.20.00 8602.10.00 2903.45.10 8211.94.50 8431.39.00 8602.90.00 2903.49.00 8211.95.10 8431.41.00 8603.10.00 2903.51.10 8211.95.50 8431.43.40 8603.90.00 2903.59.90 8211.95.90 8431.43.80 8604.00.00 2903.71.0100 8215.10.00 8433.11.00 8605.00.00 3004.90.9244 8215.20.00 8433.20.00 8607.11.00 3208.10.00 8215.91.30 8433.51.00 8607.19.0300 3208.20.00 8215.91.60 8433.59.00 8607.19.06 3208.90.00 8215.91.90 8433.90.10 8607.19.12 3209.10.00 8215.99.01 8433.90.50 8607.19.15 3209.90.00 8215.99.05 8443.16.0000 8607.19.90 3213.90.00 8215.99.10 8454.20.0010 8607.21.50 3214.10.00 8215.99.15 8454.20.0060 8607.30.1010 3303.00.10 8215.99.20 8455.30.00 8607.30.1050 3303.00.20 8215.99.22 8455.90.4000 8607.30.1090 3303.00.30 8215.99.24 8455.90.8000 8607.30.50 3304.30.00 8215.99.26 8457.10.00 8607.91.00 3304.99.50 8215.99.30 8474.90.00 8607.99.50 3305.10.00 8215.99.35 8477.10.30 8609.00.00 3305.30.00 8215.99.40 8477.10.40 8701.10.01 3305.90.00 8215.99.45 8477.10.90 8701.21.0080 3306.90.00 8215.99.50 8477.90.25 8701.22.0080 3307.10.10 8302.10.60 8477.90.8601 8701.23.0080 3307.10.20 8302.41.30 8479.89.55 8701.24.0080 3307.20.00 8302.41.60 8479.89.65 8701.29.0080 3307.49.00 8302.42.30 8479.90.45 8701.30.10 3307.90.00 8302.49.60 8479.90.55 8701.30.50 3401.30.10 8305.20.00 8479.90.65 8701.91.10 3401.30.50 8307.10.60 8479.90.75 8701.91.50 3402.31.90 8401.40.0000 8479.90.85 8701.92.10 3402.49.90 8403.10.00 8479.90.95 8701.92.50 3402.50.11 8406.90.4000 8480.49.0010 8701.93.10 3402.50.51 8407.21.00 8480.71.8045 8701.93.50 3402.90.10 8407.90.10 8480.71.8060 8701.94.10 3402.90.30 8407.90.90 8480.79.9010 8701.94.50 3402.90.50 8408.20.10 8482.10.5004 8701.95.10 3403.19.10 8408.20.90 8482.10.5008 8701.95.50 3403.19.50 8409.91.50 8482.10.5012 8702.10.31 3403.99.00 8409.91.92 8482.10.5016 8702.10.61 3405.10.00 8409.91.99 8482.10.5024 8703.10.10 3405.20.00 8409.99.91 8482.10.5028 8703.10.50 3405.40.00 8409.99.92 8482.10.5032 8703.21.01 3405.90.00 8409.99.99 8482.10.5036 8705.10.00 3506.10.50 8410.90.0000 8482.10.5052 8705.20.00 3506.91.10 8411.81.80 8482.10.5056 8705.90.0010 3506.91.50 8412.21.00 8482.10.5060 8705.90.0020 3506.99.00 8412.29.80 8482.10.5064 8706.00.30 3808.59.10 8412.90.9070 8482.10.5068 8708.40.30 3808.59.40 8412.90.9075 8482.20.0064 8708.40.60 3808.61.10 8413.81.00 8482.20.0067 8708.92.10 3808.61.50 8413.91.9055 8482.20.0090 8708.92.50 3808.62.10 8413.91.9060 8482.99.05 8708.92.60 3808.62.50 8413.91.9096 8482.99.15 8708.92.75 3808.69.10 8414.30.40 8482.99.25 8708.93.15 3808.69.50 8414.80.16 8482.99.35 8708.93.30 3808.91.15 8414.90.30 8482.99.45 8708.99.23 3808.91.25 8414.90.41 8482.99.65 8708.99.81 3808.91.30 8415.10.30 8483.10.1010 8710.00.00 3808.91.50 8415.10.60 8483.10.1050 8711.30.00 3808.94.10 8415.10.90 8483.10.50 8711.50.00 3808.94.50 8415.81.01 8483.20.40 8711.60.00 3809.91.00 8415.82.01 8483.20.80 8714.10.00 3810.10.00 8415.83.00 8483.30.40 8716.10.00 3811.19.00 8415.90.40 8483.30.80 8716.39.00 3811.21.00 8415.90.80 8483.40.10 8716.80.10 3814.00.10 8417.90.0000 8483.40.5020 8716.80.50 3814.00.20 8418.21.00 8483.40.90 8716.90.10 3814.00.50 8418.29.20 8483.50.60 8716.90.30 3820.00.00 8418.99.40 8483.50.90 9401.71.00 3824.99.9397 8419.81.50 8483.60.40 9401.79.00 3827.61.0000 8421.29.00 8483.60.80 9403.10.00 3827.62.0000 8424.10.0000 8483.90.20 9403.99.10 3827.63.0000 8424.89.90 8483.90.30 9403.99.9010 3827.64.0000 8425.42.00 8483.90.50 9403.99.9015 3827.65.0000 8426.20.00 8483.90.70 9403.99.9040 3925.20.00 8426.99.00 8483.90.80 9403.99.9045 3926.90.10 8427.10.40 8501.53.40 9403.99.9051 7614.10.10 8427.10.80 8501.53.60 9403.99.9061 8202.39.0040 8427.20.40 8501.53.80 9506.91.00 8203.40.60 8427.20.80 8501.64.0110 8205.59.55 8427.90.00 8502.31.0000 8205.70.00 8428.32.00 8503.00.35 8207.20.0070 8428.33.00 8503.00.45 8207.30.6062 8428.39.00 8503.00.65 8207.30.6095 8428.60.00 8503.00.75 8211.10.00 8428.70.00 8503.00.90 8211.91.10 8428.90.03 8503.00.95
"""
add_list(steel_derivatives, 50.0, 'Steel-Derivative')

# --- REGULAR BROAD RANGES ---
# 1. COPPER (50%)
for h in range(7406, 7420): s232_data.append({'hts8': str(h), 's232_rate': 50.0, 'category': 'Copper'})
add_list("854442 854449", 50.0, 'Copper')

# 2. SEMICONDUCTORS (25%)
add_list("847150 847180 847330", 25.0, 'Semiconductors')

# 3. AUTO-MHDV (25%) & BUSES (10%)
for h in [8701, 8704, 8705, 8706, 8708]: s232_data.append({'hts8': str(h), 's232_rate': 25.0, 'category': 'Auto-MHDV'})
s232_data.append({'hts8': '8702', 's232_rate': 10.0, 'category': 'Buses'})

# 4. WOOD
for h in [4403, 4406, 4407]: s232_data.append({'hts8': str(h), 's232_rate': 10.0, 'category': 'Wood-Lumber'})
add_list("9401614011 9401614031 9401616011 9401616031 9403409060 9403608093 9403910080", 25.0, 'Wood-Furniture/Cabinets')

# 5. STEEL (Broad chapter coverage)
for h in range(7206, 7230): s232_data.append({'hts8': str(h), 's232_rate': 25.0, 'category': 'Steel'})
for h in range(7301, 7327): s232_data.append({'hts8': str(h), 's232_rate': 50.0, 'category': 'Steel-Derivative'})

# 6. ALUMINUM (Broad coverage)
add_list("7601 7604 7605 7606 7607 7608 7609", 10.0, 'Aluminum')
add_list("7610 7612 7613 7614 7615 7616 76169951", 50.0, 'Aluminum-Derivative')

df = pd.DataFrame(s232_data).drop_duplicates(subset=['hts8'])
df.to_csv(OUTPUT_CSV, index=False)

print(f"âœ… SUCCESS! Created '{OUTPUT_CSV}' with over {len(df)} specific derivative codes.")